#! /usr/bin/env bash

function calc() {
    bc -l <<< "$@"
}

function where(){
	find . -iname "*$1*"
}

function cm() { git commit -am "$*"; }

function replaceAll(){
	echo $PWD
	echo "s/$1/$2"
	find "$PWD" -type f -iname '*.js'  -exec sed -i "s/$1/$2/" {} \;
}

function jsx() {
	# npm install -g @ast-grep/cli
	local file="$1"
	local lang="javascript"
	[[ "$file" == *.ts || "$file" == *.tsx ]] && lang="typescript"

	declare -A patterns=(
		[const]='export const $NAME = $_'
		[let]='export let $NAME = $_'
		[function]='export function $NAME($_) { $$$ }'
		[class]='export class $NAME { $$$ }'
		[type]='export type $NAME = $_'
		[interface]='export interface $NAME { $$$ }'
	)

	for kind in "${!patterns[@]}"; do
		ast-grep --pattern "${patterns[$kind]}" -l "$lang" --json "$file" 2>/dev/null \
			| jq -r --arg kind "$kind" '.[].metaVariables.single.NAME.text | "\($kind):\t\(.)"' 2>/dev/null
	done | sort -k2 | column -t -s $'\t'
}
